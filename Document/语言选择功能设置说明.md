# 语言选择功能设置说明

## 功能概述

已实现以下功能：
1. **首次启动语言选择** - 游戏首次启动时自动弹出语言选择对话框
2. **主界面语言切换** - 在设置面板中可以切换语言

## 设置步骤

### 1. 设置首次启动语言选择对话框

#### 步骤1：创建语言选择对话框UI

1. 在主菜单场景中创建一个新的GameObject，命名为 `LanguageSelectionDialog`
2. 添加一个Panel作为背景（可选，用于遮罩）
3. 在Panel内创建以下UI元素：
   - **Title Text** (TextMeshProUGUI) - 显示"选择语言"标题
   - **Description Text** (TextMeshProUGUI) - 显示描述文本
   - **Language Button Container** (GameObject) - 用于放置语言按钮的容器（建议使用Vertical Layout Group）
   - **Confirm Button** (Button) - 确认按钮
   - **Confirm Button Text** (TextMeshProUGUI) - 确认按钮文本

#### 步骤2：创建语言按钮预制体

1. 创建一个Button预制体，包含：
   - Button组件
   - TextMeshProUGUI子对象（显示语言名称）

#### 步骤3：配置LanguageSelectionDialog组件

1. 在 `LanguageSelectionDialog` GameObject上添加 `LanguageSelectionDialog` 组件
2. 在Inspector中分配以下引用：
   - **Dialog Panel** - 对话框面板（整个对话框的根对象）
   - **Title Text** - 标题文本组件
   - **Description Text** - 描述文本组件
   - **Language Button Container** - 语言按钮容器
   - **Language Button Prefab** - 语言按钮预制体
   - **Confirm Button** - 确认按钮
   - **Confirm Button Text** - 确认按钮文本

#### 步骤4：连接到MainMenuUI

1. 打开 `MainMenuUI` GameObject
2. 在 `MainMenuUI` 组件的Inspector中，找到 **Language Selection** 部分
3. 将 `LanguageSelectionDialog` GameObject拖拽到 **Language Selection Dialog** 字段

### 2. 设置主界面语言切换功能

#### 步骤1：在设置面板中添加语言选择

1. 打开设置面板GameObject（`settingsPanel`）
2. 在设置面板中添加以下UI元素：
   - **Language Label** (TextMeshProUGUI) - 显示"语言"标签
   - **Language Dropdown** (TMP_Dropdown) - 语言下拉菜单

#### 步骤2：配置SettingsPanel组件

1. 在设置面板GameObject上添加 `SettingsPanel` 组件
2. 在Inspector中分配以下引用：
   - **Language Label Text** - 语言标签文本组件
   - **Language Dropdown** - 语言下拉菜单组件（TextMeshPro版本）
   - **Legacy Language Dropdown** - 语言下拉菜单组件（Legacy版本，可选）

### 3. 初始化LocalizationManager

#### 步骤1：创建LocalizationManager预制体

1. 创建一个空的GameObject，命名为 `LocalizationManager`
2. 添加 `LocalizationManager` 组件
3. 创建或导入 `LocalizationData` ScriptableObject资源
4. 将 `LocalizationData` 资源分配给 `LocalizationManager` 的 **Localization Data** 字段
5. 将GameObject保存为Prefab

#### 步骤2：在GameInitializer中配置

1. 打开 `GameInitializer` GameObject
2. 在Inspector的 **Manager Prefabs** 部分，将 `LocalizationManager` 预制体拖拽到 **Localization Manager Prefab** 字段

## 工作流程

### 首次启动流程

1. 游戏启动时，`GameInitializer` 初始化 `LocalizationManager`
2. `MainMenuUI` 的 `Start()` 方法调用 `CheckFirstLaunch()`
3. 如果检测到是首次启动（`LocalizationManager.Instance.IsFirstLaunch()` 返回 `true`），显示语言选择对话框
4. 用户选择语言并点击确认后，语言被设置并保存，对话框关闭
5. 标记语言已选择（`MarkLanguageSelected()`），下次启动不再显示对话框

### 设置面板语言切换流程

1. 用户点击主菜单的"设置"按钮
2. 显示设置面板（包含 `SettingsPanel` 组件）
3. `SettingsPanel` 自动填充所有支持的语言到下拉菜单
4. 用户选择语言后，`LocalizationManager` 更新语言并触发 `OnLanguageChanged` 事件
5. 所有使用 `LocalizedText` 组件的UI自动更新

## 注意事项

1. **LocalizationManager初始化顺序**：确保 `LocalizationManager` 在其他需要本地化的UI之前初始化
2. **首次启动检测**：使用 `PlayerPrefs` 的 `LanguageSelected` 键来判断是否是首次启动
3. **语言按钮预制体**：确保预制体包含Button组件和TextMeshProUGUI子对象
4. **UI层级**：语言选择对话框应该显示在最上层（设置较高的Canvas Sort Order）

## 测试

### 测试首次启动语言选择

1. 删除PlayerPrefs中的 `LanguageSelected` 键（或在Unity编辑器中清除PlayerPrefs）
2. 运行游戏
3. 应该自动弹出语言选择对话框
4. 选择语言并确认
5. 重新运行游戏，对话框不应再出现

### 测试设置面板语言切换

1. 运行游戏
2. 点击"设置"按钮
3. 在语言下拉菜单中选择不同语言
4. 检查所有UI文本是否正确更新

## 故障排除

### 问题：首次启动时对话框不显示

- 检查 `MainMenuUI` 的 `Language Selection Dialog` 字段是否已分配
- 检查 `LocalizationManager` 是否正确初始化
- 检查 `IsFirstLaunch()` 是否返回 `true`（可能需要清除PlayerPrefs）

### 问题：设置面板中语言下拉菜单为空

- 检查 `SettingsPanel` 组件的 `Language Dropdown` 字段是否已分配
- 检查 `LocalizationManager` 是否正确初始化
- 检查 `GetSupportedLanguages()` 是否返回有效数据

### 问题：切换语言后UI文本不更新

- 确保UI文本组件上添加了 `LocalizedText` 组件
- 检查 `Localization Key` 是否正确设置
- 检查 `LocalizationData` 资源是否包含对应语言的翻译

