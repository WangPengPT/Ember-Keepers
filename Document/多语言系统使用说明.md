# 多语言系统使用说明

## 概述

本系统支持10种语言：
- 英语 (English)
- 简体中文 (Simplified Chinese)
- 繁体中文 (Traditional Chinese)
- 日文 (Japanese)
- 韩文 (Korean)
- 德文 (German)
- 法文 (French)
- 意大利文 (Italian)
- 葡萄牙文 (Portuguese)
- 西班牙文 (Spanish)

## 快速开始

### 1. 设置 LocalizationManager

1. 在场景中创建一个空的GameObject，命名为 "LocalizationManager"
2. 添加 `LocalizationManager` 组件
3. 创建或导入一个 `LocalizationData` ScriptableObject 资源
4. 将 `LocalizationData` 资源分配给 `LocalizationManager` 的 `Localization Data` 字段

### 2. 导入本地化数据

#### 方法一：使用编辑器工具导入JSON

1. 打开菜单：`EmberKeepers/本地化/导入本地化数据`
2. 点击"创建新的本地化数据资源"创建资源文件
3. 选择JSON文件路径（参考 `Document/Localization.json` 格式）
4. 选择目标资源
5. 点击"导入JSON数据"

#### 方法二：手动创建

1. 在Project窗口右键：`Create > EmberKeepers > Localization > LocalizationData`
2. 在Inspector中手动添加语言和文本条目

### 3. 在UI中使用本地化文本

#### 方法一：使用 LocalizedText 组件（推荐）

1. 在UI的TextMeshProUGUI组件上添加 `LocalizedText` 组件
2. 在 `Localization Key` 字段中输入键名（例如：`ui.menu.start`）
3. 文本会自动根据当前语言更新

#### 方法二：在代码中使用

```csharp
using EmberKeepers.Localization;

// 获取本地化文本
string text = LocalizationManager.Instance.GetLocalizedText("ui.menu.start");

// 带参数格式化
string text = LocalizationManager.Instance.GetLocalizedText("ui.stats.strength", 100);

// 切换语言
LocalizationManager.Instance.SetLanguage(Language.SimplifiedChinese);
```

### 4. 添加语言选择器

1. 在UI中创建一个Dropdown（TextMeshPro或Legacy）
2. 添加 `LanguageSelector` 组件
3. 将Dropdown组件分配给 `LanguageSelector`
4. 运行游戏时，下拉菜单会自动填充所有支持的语言

## JSON格式说明

本地化JSON文件格式如下：

```json
{
  "strings": [
    {
      "key": "ui.menu.start",
      "en": "Start Game",
      "zh_CN": "开始游戏",
      "zh_TW": "開始遊戲",
      "ja": "ゲーム開始",
      "ko": "게임 시작",
      "de": "Spiel starten",
      "fr": "Démarrer le jeu",
      "it": "Inizia il gioco",
      "pt": "Iniciar jogo",
      "es": "Iniciar juego"
    }
  ]
}
```

### 字段说明

- `key`: 本地化键，用于在代码中引用
- `en`: 英语文本
- `zh_CN`: 简体中文
- `zh_TW`: 繁体中文
- `ja`: 日文
- `ko`: 韩文
- `de`: 德文
- `fr`: 法文
- `it`: 意大利文
- `pt`: 葡萄牙文
- `es`: 西班牙文

### 格式化参数

支持使用 `{0}`, `{1}` 等占位符进行参数格式化：

```json
{
  "key": "ui.stats.strength",
  "en": "Strength: {0}",
  "zh_CN": "力量: {0}"
}
```

在代码中使用：
```csharp
string text = LocalizationManager.Instance.GetLocalizedText("ui.stats.strength", 100);
// 输出: "力量: 100" 或 "Strength: 100"
```

## 组件说明

### LocalizationManager

单例管理器，负责：
- 管理当前语言
- 提供文本获取接口
- 保存/加载语言设置（使用PlayerPrefs）
- 触发语言切换事件

### LocalizedText

自动本地化组件，功能：
- 自动根据当前语言更新文本
- 支持TextMeshProUGUI和Legacy Text
- 语言切换时自动更新
- 支持参数格式化

### LanguageSelector

语言选择器组件，功能：
- 自动填充所有支持的语言
- 切换语言时自动更新所有LocalizedText组件

## 最佳实践

1. **键名规范**：使用点分隔的层级结构，如 `ui.menu.start`、`ui.hero.name`
2. **默认语言**：确保英语（English）始终有完整的翻译，作为后备语言
3. **参数占位符**：使用 `{0:F1}` 等格式说明符来控制数字格式
4. **性能优化**：LocalizationManager使用字典缓存当前语言的文本，提高查找效率
5. **编辑器预览**：在编辑器中右键 `LocalizedText` 组件，选择"Preview Text"可以预览当前语言的文本

## 示例代码

### 更新UI文本

```csharp
using EmberKeepers.Localization;
using TMPro;

public class MyUI : MonoBehaviour
{
    public TextMeshProUGUI titleText;
    public LocalizedText localizedTitle; // 如果使用LocalizedText组件
    
    void Start()
    {
        // 方法1: 使用LocalizedText组件（推荐）
        // 只需在Inspector中设置key即可，无需代码
        
        // 方法2: 手动更新
        if (titleText != null)
        {
            titleText.text = LocalizationManager.Instance.GetLocalizedText("ui.menu.start");
        }
        
        // 方法3: 使用LocalizedText组件的方法
        if (localizedTitle != null)
        {
            localizedTitle.SetLocalizationKey("ui.menu.start");
        }
    }
}
```

### 监听语言切换事件

```csharp
void OnEnable()
{
    if (LocalizationManager.Instance != null)
    {
        LocalizationManager.Instance.OnLanguageChanged += OnLanguageChanged;
    }
}

void OnDisable()
{
    if (LocalizationManager.Instance != null)
    {
        LocalizationManager.Instance.OnLanguageChanged -= OnLanguageChanged;
    }
}

private void OnLanguageChanged(Language newLanguage)
{
    // 语言切换时的处理
    Debug.Log($"Language changed to: {newLanguage}");
    // 更新UI等操作
}
```

## 注意事项

1. LocalizationManager必须在场景中存在且已初始化
2. 确保LocalizationData资源已正确分配
3. 如果找不到指定语言的文本，系统会尝试使用英语作为后备
4. 如果连英语也没有，会返回键名本身
5. 语言设置会自动保存到PlayerPrefs，下次启动游戏时会自动加载

